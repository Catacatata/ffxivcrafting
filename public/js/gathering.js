var gathering={init:function(){$(".collapse").click(gathering.collapse_row),$(".level_checkbox").click(gathering.toggle_levels),$(".job_checkbox").click(gathering.toggle_classes),$("#hide_shards").change(function(){for($(".shard")[($(this).is(":checked")?"add":"remove")+"Class"]("hidden"),$(".shard")[($(this).is(":checked")?"add":"remove")+"Class"]("shard-hidden"),$(".and_more").popover("destroy"),$(".and_more").popover();$("#footer + .popover").length>0;)$("#footer + .popover").remove()}),$("#hide_quests").change(function(){var a=$(this).is(":checked");$(".quest").each(function(){var b=$(".amount_needed",$(this)),c=$("img",b);c.hasClass("level-hidden")?c[(a?"add":"remove")+"Class"]("quest-hidden"):1==a?(b.data("originalAdditional",b.data("additional")).data("additional",0),c.addClass("hidden").addClass("quest-hidden")):(b.data("additional",b.data("originalAdditional")),c.removeClass("quest-hidden").removeClass("hidden"))}),gathering.retally()}),$(".and_more").popover()},collapse_row:function(){var a=$(this),b=a.closest("tr").next("tr");a.toggleClass("glyphicon-chevron-up").toggleClass("glyphicon-chevron-down"),b.toggleClass("hidden")},toggle_levels:function(){var a=$(this);gathering[(a.is(":checked")?"show":"hide")+"_levels"](a),gathering.retally()},hide_levels:function(a){$("table.breakdown tbody tr."+a.attr("id")).each(function(){var a=$(this),b=a.closest("table").find("tfoot");b.append(a)});for(var b=a.data("level"),c=b;b+4>=c;c++)$('td.amount_needed[data-level="'+c+'"]').each(function(){$(this).data("originalAdditional",$(this).data("additional")).data("additional",0),$(this).find("img").addClass("hidden").addClass("level-hidden")})},show_levels:function(a){$("table.breakdown tfoot tr."+a.attr("id")).each(function(){var a=$(this),b=a.closest("table").find("tbody"),c=!1;$("tr",b).length>0&&$("tr",b).each(function(){var b=$(this);parseInt(a.data("level"))<b.data("level")||(b.after(a),c=!0)}),0==c&&b.prepend(a)});for(var b=a.data("level"),c=b;b+4>=c;c++)$('td.amount_needed[data-level="'+c+'"]').each(function(){$(this).data("additional",$(this).data("originalAdditional"));var a=$(this).find("img");a.removeClass("level-hidden"),a.hasClass("quest-hidden")||a.removeClass("hidden")})},toggle_classes:function(){var a=$(this);$("table.breakdown td."+a.attr("id"))[(a.is(":checked")?"remove":"add")+"Class"]("hidden"),gathering.retally()},retally:function(){$("table.breakdown").each(function(){var a=$(this),b=a.closest("tr").prev("tr"),c=0;a.find("tbody td:not(.hidden)").each(function(){var a=$(this).html();"-"!=a&&(c+=parseInt(a))});var d=b.find(".amount_needed");c+=parseInt(d.data("additional")),d.find("span").html(c.formatMoney(0,",","")),0==c?b.addClass("hidden").addClass("zero-hidden"):(!b.hasClass("shard-hidden")&&b.hasClass("zero-hidden")&&b.removeClass("hidden"),b.removeClass("zero-hidden"));var e=b.find(".total_cost"),f=parseInt(e.data("per"));f>0&&e.find("span").html((c*f).formatMoney(0,",",""))})}};$(gathering.init),Number.prototype.formatMoney=function(a,b,c){var d=this,a=isNaN(a=Math.abs(a))?2:a,c=void 0==c?".":c,b=void 0==b?",":b,e=0>d?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+b:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+b)+(a?c+Math.abs(d-f).toFixed(a).slice(2):"")};