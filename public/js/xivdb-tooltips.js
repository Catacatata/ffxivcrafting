function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),xivdb_tooltips_default={xivdb:"http://xivdb.com",language:"en",jqueryCheck:!0,jqueryCheckDuration:500,fontAwsomeEmbed:!0,seturlname:!0,seturlcolor:!0,seturlcolorDarken:!0,seturlicon:!0,iconSize:20,iconCircle:!0,tooltipFixed:!1,tooltipFixedBottom:!1,targetBlank:!0,includeHiddenLinks:!0,includeCredits:!0,includeFrameShadow:!1,includeLocalLinks:!1,preventHtmlHeight:!1,container:window,linkContainer:"body",parentTooltipAttribute:"data-xivdb",parentTooltip:!0,watch:".search-content",watchDelay:750},XIVDBTooltipsClass=function(){function a(b){_classCallCheck(this,a),this.version="0.5",this.xivdb="http://xivdb.com",this.jquery="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js",this.fa="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css",this.options=b,this.ids={},this.urls={},this.allow=!0,this.linkCount=0,this.cache={}}return _createClass(a,[{key:"initialize",value:function(){if(this.options.xivdb&&(this.xivdb=this.options.xivdb),this.setDefaults(),this.options.jqueryCheck){var a=this;if(!this.jqueryCheck())return void setTimeout(function(){a.initialize()},a.options.jqueryCheckDuration)}else if("undefined"==typeof $)return void console.error("The variable $ cannot be found, this script assumes jQuery is embeded, enable the option: jqueryCheck or embed jquery into your site");window.location.href.indexOf(this.xivdb)>-1&&(this.options.includeCredits=!1),this.setDom(),this.get(),this.watchDom()}},{key:"get",value:function(){this.allow=!1,this.hide(),this.getLinksData(),this.getTooltipsIdList(),this.recurrsiveTooltipsHandler(this.ids),this.allow=!0}},{key:"checkForNewLinks",value:function(){var a=$(this.options.linkContainer+" a").length;a!=this.linkCount&&(this.linkCount=a,this.get())}},{key:"setOption",value:function(a,b){this.options[a]=b}},{key:"jqueryCheck",value:function(){if(!window.jQuery){var a=document.createElement("script");return a.type="text/javascript",a.src=this.jquery,document.getElementsByTagName("head")[0].appendChild(a),!1}return $?!0:!1}},{key:"setDefaults",value:function(){for(var a in xivdb_tooltips_default){var b=xivdb_tooltips_default[a];"undefined"==typeof this.options[a]&&(this.options[a]=b)}}},{key:"getLinksData",value:function(){var a=this;$(this.options.linkContainer+" a").each(function(){var b=$(this),c=b.attr("href");if(c){if(isLocal=!1,isVerified=c.indexOf("xivdb.com")>-1?!0:!1,a.options.parentTooltip){var d=b.parent("["+a.options.parentTooltipAttribute+"]").attr(a.options.parentTooltipAttribute);"undefined"!=typeof d&&(b=b.parent("["+a.options.parentTooltipAttribute+"]"),isVerified=!0,isLocal=!0)}if(a.options.includeLocalLinks&&"/"==c[0]&&(isVerified=!0,isLocal=!0,b.attr("data-xivdb-seturlname",0).attr("data-xivdb-seturlcolor",0).attr("data-xivdb-seturlicon",0)),(a.options.includeHiddenLinks||b.is(":visible"))&&!b.attr("data-xivdb-ignore")&&isVerified){c=c.split("/").filter(function(a){return a});var e=c[2],f=parseInt(c[3]);if(isLocal&&(e=c[0],f=parseInt(c[1])),!e||!f)return;e=e.replace("?","");var g="xivdb_"+e+"_"+f;if(b.hasClass(g))return;a.urls[g]={type:e,id:f,key:g},b.addClass(g)}}})}},{key:"getTooltipsIdList",value:function(){var a={};for(var b in this.urls){var c=this.urls[b];"undefined"==typeof a[c.type]&&(a[c.type]=[]),a[c.type].push(c.id)}for(var d in a)a[d]=a[d].join(",");this.ids=a}},{key:"recurrsiveTooltipsHandler",value:function(a){if(0!=Object.keys(a).length){var b=this,c=Object.keys(a)[0],d={};d[c]=a[c],delete a[c],this.getTooltipHtml(d,function(){Object.keys(a).length>0&&b.recurrsiveTooltipsHandler(a)})}}},{key:"getTooltipHtml",value:function(a,b){if(a&&0!=Object.keys(a).length){var c=this;$.ajax({url:this.xivdb+"/tooltip",method:"POST",dataType:"json",data:{list:a,language:c.options.language},success:function(a){c.injectTooltips(a),b&&b()},error:function(a,b,c){console.error("----------------"),console.error("Error loading tooltips!"),console.error(a.responseText),console.error(b,c),console.error("----------------")}})}}},{key:"checkCacheAndProcessing",value:function(a){var b=Object.keys(a)[0],c=a[b].split(","),d=[];for(var e in c){var f=c[e],g="xivdb_"+b+"_"+f,h=this.cache[g];"undefined"!=typeof h&&(d.push(h),delete c[e])}return d.length>0&&this.injectTooltips(d),c=c.filter(function(a){return a}),0==c.length?null:(a[b]=c.join(","),a)}},{key:"injectTooltips",value:function(a){for(var b in a){var c=this,d=this.getFrame(),e=a[b],f=(e[0],e[1]),g=e[2],h=e[3],i=e[4],j="xivdb_"+f+"_"+g;this.cache[j]=e,d.find(".xivdb-fc").html(h);var h=d.html(),k=$("<div></div>").html(h),l=$("."+j);l.each(function(){$link=$(this),c.options.includeCredits&&k.find(".xivdb-fc").append('<div class="xivdb-copyright">xivdb.com</div>'),c.options.includeFrameShadow||k.find(".xivdb-frame-shadow").removeClass("xivdb-frame-shadow"),h=k.html(),$link.attr("data-xivdb-tt",h);var a="undefined"!=typeof $link.attr("data-xivdb-seturlname")||"undefined"!=typeof $link.attr("data-replacename")?!1:c.options.seturlname;a&&"undefined"!=typeof i.name&&$link.text(i.name);var b="undefined"!=typeof $link.attr("data-xivdb-seturlcolor")||"undefined"!=typeof $link.attr("data-colorname")?!1:c.options.seturlcolor;b&&"undefined"!=typeof i.color&&$link.addClass(c.options.seturlcolorDarken?"rarity-"+i.color+"-darken":"rarity-"+i.color);var d="undefined"!=typeof $link.attr("data-xivdb-seturlicon")||"undefined"!=typeof $link.attr("data-showicon")?!1:c.options.seturlicon;if(d&&"undefined"!=typeof i.name){var e="xivdb-ii";c.options.iconCircle&&(e+=" xivdb-iir"),$link.prepend('<img src="'+i.icon+'" class="'+e+'" height="'+c.options.iconSize+'">')}})}}},{key:"setDom",value:function(){var a=this;$("head").append('<link href="'+this.xivdb+"/tooltips.css?v="+this.version+'" rel="stylesheet" type="text/css">'),this.options.fontAwsomeEmbed&&$("head").append('<link href="'+this.fa+"?v="+this.version+'" rel="stylesheet" type="text/css">'),$("body").append('<div class="xivdb"></div>').on("mouseenter","*[data-xivdb-tt]",function(b){if($(".xivdb").html($(this).attr("data-xivdb-tt")),a.show(b),a.options.targetBlank&&$(this).attr("target","_blank"),a.options.tooltipFixed){var c=$(this).offset(),d=c.left,e=c.top;a.options.tooltipFixedBottom?e+=2*$(this).outerHeight():e-=$(".xivdb").outerHeight()+$(this).outerHeight(),a.position(d,e)}else $(this).unbind("mousemove").mousemove(function(b){a.follow(b)})}).on("mouseleave","*[data-xivdb-tt]",function(){a.hide()}),this.options.preventHtmlHeight||$("html").css({height:"100%"})}},{key:"watchDom",value:function(){if(this.options.watch){var a=this,b=null,c=0;$(this.options.watch).bind("DOMSubtreeModified",function(){clearTimeout(b),$(this).html().length!=c&&(c=$(this).html().length,b=setTimeout(function(){a.allow&&a.checkForNewLinks()},a.options.watchDelay))})}}},{key:"show",value:function(a){this.follow(a),$(".xivdb").show()}},{key:"follow",value:function(a){if(!this.options.tooltipFixed){var b=a.pageX+12,c=a.pageY+12,d=$(".xivdb").outerWidth(!0),e=$(".xivdb").outerHeight(!0),f=c+e,g=b+d,h=$(this.options.container).height()+$(this.options.container).scrollTop(),i=$(this.options.container).scrollLeft()+$(this.options.container).width();g>i&&(b=a.pageX-d),f>h&&(c=a.pageY-e),this.position(b,c)}}},{key:"hide",value:function(){$(".xivdb").html("").empty().hide(),this.position(0,0)}},{key:"position",value:function(a,b){$(".xivdb").css({top:b+"px",left:a+"px"})}},{key:"getFrame",value:function(){return $("<div></div>").html('<table class="xivdb-frame xivdb-frame-shadow" width="0" border="0" cellspacing="0" cellpadding="0"><tr><td class="xivdb-fw xivdb-ftl"></td><td class="xivdb-fh xivdb-ft"></td><td class="xivdb-fw xivdb-ftr"></td></tr><tr><td class="xivdb-fw xivdb-fml"></td><td class="xivdb-fc" valign="top"></td><td class="xivdb-fw xivdb-fmr"></td></tr><tr><td class="xivdb-fw xivdb-fbl"></td><td class="xivdb-fh xivdb-fb"></td><td class="xivdb-fw xivdb-fbr"></td></tr></table>')}}]),a}(),XIVDBTooltips=new XIVDBTooltipsClass("undefined"!=typeof xivdb_tooltips?xivdb_tooltips:{});XIVDBTooltips.initialize();