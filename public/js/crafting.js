var crafting={init:function(){crafting.events(),crafting_tour.init()},events:function(){$("#self_sufficient_switch").change(function(){$(this).closest("form").submit()}),$("#obtain-these-items .collapse").click(function(){var a=$(this);a.toggleClass("glyphicon-chevron-down").toggleClass("glyphicon-chevron-up");var b=$(this).closest("tbody"),c=b.find("tr:not(:first-child)");c.toggleClass("hidden")}),$(".needed input, input.obtained").each(function(){var a=$(this);a.data("amount",parseInt(a.val()))}),$(".needed input").change(function(){var a=$(this),b=parseInt(a.val()),c=a.data("amount"),d=b-c;if(0!=d){a.data("amount",b);var e=a.closest("tr");crafting.change_reagents(a.closest("tr"),d),e.find("input.obtained").trigger("change")}}),$("input.obtained").change(function(){var a=$(this),b=a.closest("tr"),c=parseInt(a.val()),d=b.find(".needed input"),e=parseInt(d.val());if(0==d.length&&(d=b.find(".needed span"),e=parseInt(d.html())),c>e&&(c=e,a.val(c)),b[(c>=e?"add":"remove")+"Class"]("success"),b.closest("#CraftingList-section").length>0){var f=a.data("amount");a.data("amount",c);var g=f-c;0!=g&&crafting.change_reagents(b,g)}}),$(".obtained-ok").click(function(){var a=$(this).closest("tr"),b=a.find(".needed input"),c=b.val(),d=a.find("input.obtained");0==b.length&&(b=a.find(".needed span"),c=b.html()),d.val(c).trigger("change")})},change_reagents:function(a,b){var c=a.data("requires"),d=a.data("itemId");if("undefined"!=typeof c&&""!=c){var e=c.split("&");a.hasClass("exempt")&&$("tr.reagent:not(.exempt)[data-item-id="+a.data("itemId")+"]").length>0&&(e[e.length]="1x"+d);for(var f=0;f<e.length;f++){var g=e[f].split("x"),h=g[0],i=g[1],j=$("tr.reagent:not(.exempt)[data-item-id="+i+"]"),k=j.find(".needed span"),l=parseInt(k.html()),m=b*h;k.html(l+m),i!=d&&crafting.change_reagents(j,m);var n=j.find("input.obtained");n.trigger("change"),n[(0==l+m?"add":"remove")+"Class"]("disabled").prop("disabled",0==l+m?"disabled":"")}}}},crafting_tour={tour:null,first_run:!0,init:function(){var a=$("#start_tour");crafting_tour.tour=new Tour({orphan:!0,onStart:function(){return a.addClass("disabled",!0)},onEnd:function(){return a.removeClass("disabled",!0)}}),a.click(function(a){a.preventDefault(),$("#toggle-slim").bootstrapSwitch("status")&&$("#toggle-slim").bootstrapSwitch("setState",!1),1==crafting_tour.first_run&&crafting_tour.build(),$(this).hasClass("disabled")||crafting_tour.tour.restart()})},build:function(){crafting_tour.tour.addSteps([{element:"#CraftingList-section",title:"Recipe List",content:"The list at the bottom is your official Recipe List.  You will be making these items.",placement:"top"},{element:"#Gathered-section tr:first-child",title:"Gathered Section",content:"Items you can gather with MIN, BTN or FSH will appear in the Gathered Section.",placement:"bottom"},{element:"#Bought-section tr:first-child",title:"Bought Section",content:"Items you cannot gather will be thrown into the Bought Section.",placement:"bottom"},{element:"#Other-section tr:first-child",title:"Other Section",content:"Items that cannot be bought or gathered show up in the Other Section.  Most likely these will involve monster drops.",placement:"bottom"},{element:"#PreRequisiteCrafting-section tr:first-child",title:"Pre-Requisite Crafting",content:"Why buy what you can craft?  The Crafted Section contains items necessary for your main recipes to finish.  The previous sections will already contain the sub items required.",placement:"bottom"},{element:"#self-sufficient-form",title:"Self Sufficient",content:"By default it assumes you want to be Self Sufficient.  Turning this option off will eliminate the Gathering and Crafting aspect and appropriately force the items into either Bought or Other.",placement:"top"},{element:"#leveling-information",title:"Leveling Information",content:"Pay attention to the Leveling Information box as it will give you a heads up as to what your next quest turn ins will require.",placement:"top"}]),crafting_tour.first_run=!1}};$(crafting.init);