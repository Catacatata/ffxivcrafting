function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(i,e,o){return e&&t(i.prototype,e),o&&t(i,o),i}}(),xivdb_tooltips_default={xivdb:"http://xivdb.com",language:"en",jqueryCheck:!0,jqueryCheckDuration:500,fontAwsomeEmbed:!0,seturlname:!0,seturlcolor:!0,seturlcolorDarken:!0,seturlicon:!0,iconSize:20,iconCircle:!0,tooltipFixed:!1,tooltipFixedBottom:!1,targetBlank:!0,includeHiddenLinks:!0,includeCredits:!0,includeFrameShadow:!1,includeLocalLinks:!1,preventHtmlHeight:!1,container:window,linkContainer:"body",parentTooltipAttribute:"data-xivdb",parentTooltip:!0,watch:".search-content",watchDelay:750},XIVDBTooltipsClass=function(){function t(i){_classCallCheck(this,t),this.version="0.5",this.xivdb="http://xivdb.com",this.jquery="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js",this.fa="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css",this.options=i,this.ids={},this.urls={},this.allow=!0,this.linkCount=0,this.cache={}}return _createClass(t,[{key:"initialize",value:function(){if(this.options.xivdb&&(this.xivdb=this.options.xivdb),this.setDefaults(),this.options.jqueryCheck){var t=this;if(!this.jqueryCheck())return void setTimeout(function(){t.initialize()},t.options.jqueryCheckDuration)}else if("undefined"==typeof $)return void console.error("The variable $ cannot be found, this script assumes jQuery is embeded, enable the option: jqueryCheck or embed jquery into your site");window.location.href.indexOf(this.xivdb)>-1&&(this.options.includeCredits=!1),this.setDom(),this.get(),this.watchDom()}},{key:"get",value:function(){this.allow=!1,this.hide(),this.getLinksData(),this.getTooltipsIdList(),this.recurrsiveTooltipsHandler(this.ids),this.allow=!0}},{key:"checkForNewLinks",value:function(){var t=$(this.options.linkContainer+" a").length;t!=this.linkCount&&(this.linkCount=t,this.get())}},{key:"setOption",value:function(t,i){this.options[t]=i}},{key:"jqueryCheck",value:function(){if(!window.jQuery){var t=document.createElement("script");return t.type="text/javascript",t.src=this.jquery,document.getElementsByTagName("head")[0].appendChild(t),!1}return $?!0:!1}},{key:"setDefaults",value:function(){for(var t in xivdb_tooltips_default){var i=xivdb_tooltips_default[t];"undefined"==typeof this.options[t]&&(this.options[t]=i)}}},{key:"getLinksData",value:function(){var t=this;$(this.options.linkContainer+" a").each(function(){var i=$(this),e=i.attr("href");if(e){if(isLocal=!1,isVerified=e.indexOf("xivdb.com")>-1?!0:!1,t.options.parentTooltip){var o=i.parent("["+t.options.parentTooltipAttribute+"]").attr(t.options.parentTooltipAttribute);"undefined"!=typeof o&&(i=i.parent("["+t.options.parentTooltipAttribute+"]"),isVerified=!0,isLocal=!0)}if(t.options.includeLocalLinks&&"/"==e[0]&&(isVerified=!0,isLocal=!0,i.attr("data-xivdb-seturlname",0).attr("data-xivdb-seturlcolor",0).attr("data-xivdb-seturlicon",0)),(t.options.includeHiddenLinks||i.is(":visible"))&&!i.attr("data-xivdb-ignore")&&isVerified){e=e.split("/").filter(function(t){return t});var n=e[2],s=parseInt(e[3]);if(isLocal&&(n=e[0],s=parseInt(e[1])),!n||!s)return;n=n.replace("?","");var a="xivdb_"+n+"_"+s;if(i.hasClass(a))return;t.urls[a]={type:n,id:s,key:a},i.addClass(a)}}})}},{key:"getTooltipsIdList",value:function(){var t={};for(var i in this.urls){var e=this.urls[i];"undefined"==typeof t[e.type]&&(t[e.type]=[]),t[e.type].push(e.id)}for(var o in t)t[o]=t[o].join(",");this.ids=t}},{key:"recurrsiveTooltipsHandler",value:function(t){if(0!=Object.keys(t).length){var i=this,e=Object.keys(t)[0],o={};o[e]=t[e],delete t[e],this.getTooltipHtml(o,function(){Object.keys(t).length>0&&i.recurrsiveTooltipsHandler(t)})}}},{key:"getTooltipHtml",value:function(t,i){if(t&&0!=Object.keys(t).length){var e=this;$.ajax({url:this.xivdb+"/tooltip",method:"POST",dataType:"json",data:{list:t,language:e.options.language},success:function(t){e.injectTooltips(t),i&&i()},error:function(t,i,e){console.error("----------------"),console.error("Error loading tooltips!"),console.error(t.responseText),console.error(i,e),console.error("----------------")}})}}},{key:"checkCacheAndProcessing",value:function(t){var i=Object.keys(t)[0],e=t[i].split(","),o=[];for(var n in e){var s=e[n],a="xivdb_"+i+"_"+s,r=this.cache[a];"undefined"!=typeof r&&(o.push(r),delete e[n])}return o.length>0&&this.injectTooltips(o),e=e.filter(function(t){return t}),0==e.length?null:(t[i]=e.join(","),t)}},{key:"injectTooltips",value:function(t){for(var i in t){var e=this,o=this.getFrame(),n=t[i],s=(n[0],n[1]),a=n[2],r=n[3],l=n[4],d="xivdb_"+s+"_"+a;this.cache[d]=n,o.find(".xivdb-fc").html(r);var r=o.html(),c=$("<div></div>").html(r),h=$("."+d);h.each(function(){$link=$(this),e.options.includeCredits&&c.find(".xivdb-fc").append('<div class="xivdb-copyright">xivdb.com</div>'),e.options.includeFrameShadow||c.find(".xivdb-frame-shadow").removeClass("xivdb-frame-shadow"),r=c.html(),$link.attr("data-xivdb-tt",r);var t="undefined"!=typeof $link.attr("data-xivdb-seturlname")||"undefined"!=typeof $link.attr("data-replacename")?!1:e.options.seturlname;t&&"undefined"!=typeof l.name&&$link.text(l.name);var i="undefined"!=typeof $link.attr("data-xivdb-seturlcolor")||"undefined"!=typeof $link.attr("data-colorname")?!1:e.options.seturlcolor;i&&"undefined"!=typeof l.color&&(e.options.seturlcolorDarken?$link.addClass("rarity-"+l.color+"-darken"):$link.addClass("rarity-"+l.color));var o="undefined"!=typeof $link.attr("data-xivdb-seturlicon")||"undefined"!=typeof $link.attr("data-showicon")?!1:e.options.seturlicon;if(o&&"undefined"!=typeof l.name){var n="xivdb-ii";e.options.iconCircle&&(n+=" xivdb-iir"),$link.prepend('<img src="'+l.icon+'" class="'+n+'" height="'+e.options.iconSize+'">')}})}}},{key:"setDom",value:function(){var t=this;$("head").append('<link href="'+this.xivdb+"/tooltips.css?v="+this.version+'" rel="stylesheet" type="text/css">'),this.options.fontAwsomeEmbed&&$("head").append('<link href="'+this.fa+"?v="+this.version+'" rel="stylesheet" type="text/css">'),$("body").append('<div class="xivdb"></div>').on("mouseenter","*[data-xivdb-tt]",function(i){if($(".xivdb").html($(this).attr("data-xivdb-tt")),t.show(i),t.options.targetBlank&&$(this).attr("target","_blank"),t.options.tooltipFixed){var e=$(this).offset(),o=e.left,n=e.top;t.options.tooltipFixedBottom?n+=2*$(this).outerHeight():n-=$(".xivdb").outerHeight()+$(this).outerHeight(),t.position(o,n)}else $(this).unbind("mousemove").mousemove(function(i){t.follow(i)})}).on("mouseleave","*[data-xivdb-tt]",function(){t.hide()}),this.options.preventHtmlHeight||$("html").css({height:"100%"})}},{key:"watchDom",value:function(){if(this.options.watch){var t=this,i=null,e=0;$(this.options.watch).bind("DOMSubtreeModified",function(){clearTimeout(i),$(this).html().length!=e&&(e=$(this).html().length,i=setTimeout(function(){t.allow&&t.checkForNewLinks()},t.options.watchDelay))})}}},{key:"show",value:function(t){this.follow(t),$(".xivdb").show()}},{key:"follow",value:function(t){if(!this.options.tooltipFixed){var i=t.pageX+12,e=t.pageY+12,o=$(".xivdb").outerWidth(!0),n=$(".xivdb").outerHeight(!0),s=e+n,a=i+o,r=$(this.options.container).height()+$(this.options.container).scrollTop(),l=$(this.options.container).scrollLeft()+$(this.options.container).width();a>l&&(i=t.pageX-o),s>r&&(e=t.pageY-n),this.position(i,e)}}},{key:"hide",value:function(){$(".xivdb").html("").empty().hide(),this.position(0,0)}},{key:"position",value:function(t,i){$(".xivdb").css({top:i+"px",left:t+"px"})}},{key:"getFrame",value:function(){return $("<div></div>").html('<table class="xivdb-frame xivdb-frame-shadow" width="0" border="0" cellspacing="0" cellpadding="0"><tr><td class="xivdb-fw xivdb-ftl"></td><td class="xivdb-fh xivdb-ft"></td><td class="xivdb-fw xivdb-ftr"></td></tr><tr><td class="xivdb-fw xivdb-fml"></td><td class="xivdb-fc" valign="top"></td><td class="xivdb-fw xivdb-fmr"></td></tr><tr><td class="xivdb-fw xivdb-fbl"></td><td class="xivdb-fh xivdb-fb"></td><td class="xivdb-fw xivdb-fbr"></td></tr></table>')}}]),t}(),XIVDBTooltips=new XIVDBTooltipsClass("undefined"!=typeof xivdb_tooltips?xivdb_tooltips:{});XIVDBTooltips.initialize();